<Project DefaultTargets = "BuildSolution" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" >
	
	<Import Project="$(MSBuildExtensionsPath)\ExtensionPack\MSBuild.ExtensionPack.tasks" Condition="Exists('$(MSBuildExtensionsPath)\ExtensionPack\MSBuild.ExtensionPack.tasks')" />	
	<Import Project="$(ExtensionTasksPath)MSBuild.ExtensionPack.tasks" Condition="Exists('$(ExtensionTasksPath)MSBuild.ExtensionPack.tasks') And !Exists('$(MSBuildExtensionsPath)\ExtensionPack\MSBuild.ExtensionPack.tasks')" />

	<PropertyGroup>
		<NuGetExe Condition="$(NuGetExe) == ''">.\.nuget\nuget.exe</NuGetExe>
		<ProjectRoot Condition="$(Local) == 'true'">\Projects\asicentral.com\Projects</ProjectRoot>
		<ProjectRoot Condition="$(Local) == ''">\asicentral.com\Projects</ProjectRoot>
	</PropertyGroup>

	<Target Name="NuGet">
		<ItemGroup>
		  <NuGetPackageConfigs Include="**\**\packages.config" />
		</ItemGroup>
		<Exec Command="$(NuGetExe) install %(NuGetPackageConfigs.Identity) -o packages" />
	</Target>
	
	<Target Name="Compile ASI Admin" DependsOnTargets="NuGet">
		<MSBuild Projects=".\Projects\ASI Admin\src\Admin Tool.sln" Targets="Rebuild" Properties="Configuration=Release;Platform=Any CPU"/>
	</Target>
	
	<Target Name="Compile Template" DependsOnTargets="NuGet">
		<MSBuild Projects=".\Projects\Template\src\Template.sln" Targets="Rebuild" Properties="Configuration=Release;Platform=Any CPU"/>
	</Target>
	
	<Target Name="Package Template" DependsOnTargets="Compile Template" Condition="'$(CREATEZIP)'=='true'">
		<CreateItem Include=".\Projects\Template\src\Web Application\**\*" 
			Exclude=".\Projects\Template\src\Web Application\**\*.cs;.\Projects\Template\src\Web Application\**\*.resx;.\Projects\Template\src\Web Application\**\thumb.db;.\Projects\Template\src\Web Application\Properties\**;.\Projects\Template\src\Web Application\obj\**;.\Projects\Template\src\Web Application\Web*.config;.\Projects\Template\src\Web Application\Web Application.csproj;.\Projects\Template\src\Web Application\Web Application.csproj.user">
			
			<Output TaskParameter="Include" ItemName="TemplateWebFiles"/>
		</CreateItem>
		<CreateItem Include=".\Projects\Template\Config\**\*">
			<Output TaskParameter="Include" ItemName="TemplateConfigFiles"/>
		</CreateItem>
		<CreateItem Include=".\Projects\Template\sql\**\*">
			<Output TaskParameter="Include" ItemName="TemplateSQLFiles"/>
		</CreateItem>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="Create" RemoveRoot="$(ProjectRoot)\Template\src" CompressFiles="@(TemplateWebFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-Template-$(BUILD_NUMBER).zip"/>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="AddFiles" RemoveRoot="$(ProjectRoot)\Template" CompressFiles="@(TemplateConfigFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-Template-$(BUILD_NUMBER).zip"/>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="AddFiles" RemoveRoot="$(ProjectRoot)\Template" CompressFiles="@(TemplateSQLFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-Template-$(BUILD_NUMBER).zip"/>
		<Message Text="Zip file created" />
	</Target>

	<Target Name="Package ASI Admin" DependsOnTargets="Compile ASI Admin" Condition="'$(CREATEZIP)'=='true'">
		<CreateItem Include=".\Projects\ASI Admin\src\Web Application\**\*" 
			Exclude=".\Projects\ASI Admin\src\Web Application\**\*.cs;.\Projects\ASI Admin\src\Web Application\**\*.resx;.\Projects\ASI Admin\src\Web Application\**\thumb.db;.\Projects\ASI Admin\src\Web Application\Properties\**;.\Projects\ASI Admin\src\Web Application\obj\**;.\Projects\ASI Admin\src\Web Application\Web*.config;.\Projects\ASI Admin\src\Web Application\Web Application.csproj;.\Projects\ASI Admin\src\Web Application\Web Application.csproj.user">
			
			<Output TaskParameter="Include" ItemName="ASIAdminWebFiles"/>
		</CreateItem>
		<CreateItem Include=".\Projects\ASI Admin\Config\**\*">
			<Output TaskParameter="Include" ItemName="ASIAdminConfigFiles"/>
		</CreateItem>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="Create" RemoveRoot="$(ProjectRoot)\ASI Admin\src" CompressFiles="@(ASIAdminWebFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-ASIAdmin-$(BUILD_NUMBER).zip"/>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="AddFiles" RemoveRoot="$(ProjectRoot)\ASI Admin" CompressFiles="@(ASIAdminConfigFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-ASIAdmin-$(BUILD_NUMBER).zip"/>
		<Message Text="Zip file created" />
	</Target>

	<Target Name="Compile" DependsOnTargets="Compile ASI Admin;Compile Template" />

	<Target Name="Package" DependsOnTargets="Package ASI Admin;Package Template" Condition="'$(CREATEZIP)'=='true'" />
	
	<Target Name="BuildSolutions" DependsOnTargets="Compile;Package">
		<Message Text="Builds has been completed" />
	</Target>
</Project>