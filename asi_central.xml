<Project DefaultTargets = "BuildSolution" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" >
	
	<Import Project="$(MSBuildExtensionsPath)\ExtensionPack\MSBuild.ExtensionPack.tasks" Condition="Exists('$(MSBuildExtensionsPath)\ExtensionPack\MSBuild.ExtensionPack.tasks')" />	
	<Import Project="$(ExtensionTasksPath)MSBuild.ExtensionPack.tasks" Condition="Exists('$(ExtensionTasksPath)MSBuild.ExtensionPack.tasks') And !Exists('$(MSBuildExtensionsPath)\ExtensionPack\MSBuild.ExtensionPack.tasks')" />

	<Target Name="NuGet">
		<ItemGroup>
			<NuGetPackageConfigs Include="**\**\packages.config" />
		</ItemGroup>
		<Exec Command="$(NuGetExe) install %(NuGetPackageConfigs.Identity) -o packages" />
	</Target>
	
	<Target Name="Compile ASI Admin" DependsOnTargets="NuGet">
		<MSBuild Projects=".\Projects\ASI Admin\src\Admin Tool.sln" Targets="Rebuild" Properties="Configuration=Release;Platform=Any CPU"/>
	</Target>
	
	<Target Name="Compile Template" DependsOnTargets="NuGet">
		<MSBuild Projects=".\Projects\Template\src\Template.sln" Targets="Rebuild" Properties="Configuration=Release;Platform=Any CPU"/>
	</Target>
	
	<Target Name="Package Template" DependsOnTargets="Compile Template" Condition="'$(CREATEZIP)'=='true'">
		<CreateItem Include=".\Projects\Template\src\Web Application\**\*" 
			Exclude=".\Projects\Template\src\**\*.cs;.\Projects\Template\src\Web Application\App_Start\**;.\Projects\Template\src\Web Application\Content\**;.\Projects\Template\src\Web Application\Controllers\**;.\Projects\Template\src\Web Application\DependencyResolution\**;.\Projects\Template\src\Web Application\Models\**;.\Projects\Template\src\Web Application\Properties\**;.\Projects\Template\src\Web Application\obj\**;.\Projects\Template\src\Web Application\*.config;.\Projects\Template\src\Web Application\Web Application.csproj;.\Projects\Template\src\Web Application\Web Application.csproj.user">
			
			<Output TaskParameter="Include" ItemName="WebFiles"/>
		</CreateItem>
		<CreateItem Include=".\Projects\Template\Config\**\*">
			<Output TaskParameter="Include" ItemName="ConfigFiles"/>
		</CreateItem>
		<CreateItem Include=".\Projects\Template\sql\**\*">
			<Output TaskParameter="Include" ItemName="SQLFiles"/>
		</CreateItem>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="Create" RemoveRoot="\Projects\asi_central\Projects\Template\src" CompressFiles="@(WebFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-Template-$(BUILD_NUMBER).zip"/>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="AddFiles" RemoveRoot="\Projects\asi_central\Projects\Template" CompressFiles="@(ConfigFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-Template-$(BUILD_NUMBER).zip"/>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="AddFiles" RemoveRoot="\Projects\asi_central\Projects\Template" CompressFiles="@(SQLFiles)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-Template-$(BUILD_NUMBER).zip"/>
		<Message Text="Zip file created" />
	</Target>

	<Target Name="Package ASI Admin" DependsOnTargets="Compile ASI Admin" Condition="'$(CREATEZIP)'=='true'">
		<CreateItem Include=".\Projects\ASI Admin\src\Web Application\**\*" 
			Exclude=".\Projects\ASI Admin\src\**\*.cs;.\Projects\ASI Admin\src\Web Application\App_Start\**;.\Projects\ASI Admin\src\Web Application\Content\**;.\Projects\ASI Admin\src\Web Application\Controllers\**;.\Projects\ASI Admin\src\Web Application\DependencyResolution\**;.\Projects\ASI Admin\src\Web Application\Models\**;.\Projects\ASI Admin\src\Web Application\Properties\**;.\Projects\ASI Admin\src\Web Application\obj\**;.\Projects\ASI Admin\src\Web Application\*.config;.\Projects\ASI Admin\src\Web Application\Web Application.csproj;.\Projects\ASI Admin\src\Web Application\Web Application.csproj.user">
			
			<Output TaskParameter="Include" ItemName="WebFiles2"/>
		</CreateItem>
		<CreateItem Include=".\Projects\ASI Admin\Config\**\*">
			<Output TaskParameter="Include" ItemName="ConfigFiles2"/>
		</CreateItem>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="Create" RemoveRoot="\Projects\asi_central\Projects\ASI Admin\src" CompressFiles="@(WebFiles2)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-ASIAdmin-$(BUILD_NUMBER).zip"/>
		<MSBuild.ExtensionPack.Compression.Zip TaskAction="AddFiles" RemoveRoot="\Projects\asi_central\Projects\ASI Admin" CompressFiles="@(ConfigFiles2)" ZipFileName="$(BUILDTARGETDIR)\$(JOB_NAME)-ASIAdmin-$(BUILD_NUMBER).zip"/>
		<Message Text="Zip file created" />
	</Target>

	<Target Name="Compile" DependsOnTargets="Compile ASI Admin;Compile Template" />

	<Target Name="Package" DependsOnTargets="Package ASI Admin;Package Template" Condition="'$(CREATEZIP)'=='true'" />
	
	<Target Name="BuildSolutions" DependsOnTargets="Compile;Package">
		<Message Text="Builds has been completed" />
	</Target>
</Project>