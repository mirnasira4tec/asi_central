@model asi.asicentral.web.model.store.order.OrderStatisticData

@{
    ViewBag.Title = "Statistics";
    Layout = "~/Views/Shared/_StoreLayout.cshtml";
}

<h1>Campaign Statistics</h1>
<form method="post">
<div class="row-fluid well" >
    <div class="span1">&nbsp;</div>
    <div class="span3">
        <label for="Campaign">Campaign:</label>
        <input class="input-medium" type="text" name="Campaign" value="@Model.Campaign" />
    </div>
    <div class="span3">
        <label for="StartDate">Start Date:</label>
        <input class="input-medium" type="text" data-type="date" name="StartDate" value="@Model.StartDate" />
    </div>
    <div class="span3">
        <label for="StartDate">End Date:</label>
        <input class="input-medium" type="text" data-type="date" name="EndDate" value="@Model.EndDate" />
    </div>
    <div class="span2">
        <br />
        <input class="btn btn-primary" type="submit" value="Refresh" />
    </div>
</div>
</form>
    @if (Model.Data.Count > 0) {
        string oldGroupName = string.Empty;
        string currentGroupName = oldGroupName;
        int count = 0;
        decimal? total = 0;
        foreach (asi.asicentral.web.model.store.order.GroupedData data in Model.Data)
        {
            currentGroupName = string.IsNullOrEmpty(data.Campaign) ? "(Unknown)" : data.Campaign;
            if (currentGroupName != oldGroupName && oldGroupName != string.Empty)
            {
                //new group, not the first one
                <div class="row-fluid">
                    <div class="span1">&nbsp;</div>
                    <div class="span4"><h3>Total</h3></div>
                    <div class="span1"><h3>@count</h3></div>
                    <div class="span1"><h3>@total.Value.ToString("C")</h3></div>
                    <div class="span1">&nbsp;</div>
                    <div class="span3"><h3>(@((total.Value * 12).ToString("C")))</h3></div>
                    <div class="span1">&nbsp;</div>
                </div>
                count = 0;
                total = 0;
            }
            if (currentGroupName != oldGroupName)
            {
                <div class="row-fluid">
                    <div class="span2"><h2>@currentGroupName</h2></div>
                    <div class="span10">&nbsp;</div>
                </div>
                oldGroupName = currentGroupName;
            }
            count += data.Count;
            if (data.CompletedStep > 3 && data.Amount.HasValue)
            {
                total += data.Amount;
            }
            <div class="row-fluid">
                <div class="span1">&nbsp;</div>
                <div class="span4">@data.StepLabel</div>
                <div class="span1">@data.Count</div>
                <div class="span1">@(data.CompletedStep > 3 ? data.Amount.Value.ToString("C") : "")</div>
                <div class="span5">&nbsp;</div>
            </div>
        }
        <div class="row-fluid">
            <div class="span1">&nbsp;</div>
            <div class="span4"><h3>Total</h3></div>
            <div class="span1"><h3>@count</h3></div>
            <div class="span1"><h3>@total.Value.ToString("C")</h3></div>
            <div class="span1">&nbsp;</div>
            <div class="span3"><h3>(@((total.Value * 12).ToString("C")))</h3></div>
            <div class="span1">&nbsp;</div>
        </div>
    }
@section scripts {
    @Scripts.Render("~/bundles/form")
    <script>
        $('input[data-type*="date"]').datepicker();    </script>
}